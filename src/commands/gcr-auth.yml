description: >
  Configure Docker to use gcloud as a credential helper. Using this command requires the use of a 'machine' executor.

parameters:
  google-project-id:
    type: env_var_name
    default: GOOGLE_PROJECT_ID
    description: >
      Environment variable name for the Google project ID to connect with
      via the gcloud CLI

  registry-url:
    description: >
      The GCR registry URL from ['', us, eu, asia].gcr.io,
      or an artifact registry url from [GOOGLE_COMPUTE_REGION, us, eu, asia]-docker.pkg.dev
    type: string
    default: gcr.io

steps:
  - run:
      name: gcloud auth configure-docker
      environment:
        ORB_ENV_PROJECT_ID: << parameters.google-project-id >>
        ORB_VAL_REGISTRY_URL: << parameters.registry-url >>
      command: << include(scripts/gcr-auth.sh) >>
